name: nebula-extended
topology:
  nodes:
    #---------------------------------Switches (OVS Bridges)---------------------------------
    switch1:
      kind: ovs-bridge
    switch2:
      kind: ovs-bridge
    switch3:
      kind: ovs-bridge
    switch4:
      kind: ovs-bridge
    switch5:
      kind: ovs-bridge
    switch6:
      kind: ovs-bridge
    switch7:
      kind: ovs-bridge
    switch8:
      kind: ovs-bridge
    switch9:
      kind: ovs-bridge
    switch10:
      kind: ovs-bridge
    switch11:
      kind: ovs-bridge
    switch12:
      kind: ovs-bridge
    switch13:
      kind: ovs-bridge
    switch14:
      kind: ovs-bridge
    switch15:
      kind: ovs-bridge
    switch16:
      kind: ovs-bridge
    switch17:
      kind: ovs-bridge
    switch18:
      kind: ovs-bridge
    switch19:
      kind: ovs-bridge
    switch20:
      kind: ovs-bridge
    switch21:
      kind: ovs-bridge
    switch22:
      kind: ovs-bridge
    switch23:
      kind: ovs-bridge
    switch24:
      kind: ovs-bridge
    switch25:
      kind: ovs-bridge
    switch26:
      kind: ovs-bridge
    switch27:
      kind: ovs-bridge
    switch28:
      kind: ovs-bridge
    switch29:
      kind: ovs-bridge
    switch30:
      kind: ovs-bridge
    switch31:
      kind: ovs-bridge
    switch32:
      kind: ovs-bridge
    switch33:
      kind: ovs-bridge
    switch34:
      kind: ovs-bridge
    switch35:
      kind: ovs-bridge
    switch36:
      kind: ovs-bridge
    switch37:
      kind: ovs-bridge

    #---------------------------------Routers (FRR)---------------------------------
    router1:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router1/daemons:/etc/frr/daemons
        - router1/frr.conf:/etc/frr/frr.conf
    router2:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router2/daemons:/etc/frr/daemons
        - router2/frr.conf:/etc/frr/frr.conf
    router3:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router3/daemons:/etc/frr/daemons
        - router3/frr.conf:/etc/frr/frr.conf
    router4:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router4/daemons:/etc/frr/daemons
        - router4/frr.conf:/etc/frr/frr.conf
    router5:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router5/daemons:/etc/frr/daemons
        - router5/frr.conf:/etc/frr/frr.conf
    router6:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router6/daemons:/etc/frr/daemons
        - router6/frr.conf:/etc/frr/frr.conf
    router7:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router7/daemons:/etc/frr/daemons
        - router7/frr.conf:/etc/frr/frr.conf
    router8:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router8/daemons:/etc/frr/daemons
        - router8/frr.conf:/etc/frr/frr.conf
    router9:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router9/daemons:/etc/frr/daemons
        - router9/frr.conf:/etc/frr/frr.conf
    router10:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router10/daemons:/etc/frr/daemons
        - router10/frr.conf:/etc/frr/frr.conf
    router11:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router11/daemons:/etc/frr/daemons
        - router11/frr.conf:/etc/frr/frr.conf
    router12:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router12/daemons:/etc/frr/daemons
        - router12/frr.conf:/etc/frr/frr.conf
    router13:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router13/daemons:/etc/frr/daemons
        - router13/frr.conf:/etc/frr/frr.conf
    router14:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router14/daemons:/etc/frr/daemons
        - router14/frr.conf:/etc/frr/frr.conf
    router15:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router15/daemons:/etc/frr/daemons
        - router15/frr.conf:/etc/frr/frr.conf
    router16:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router16/daemons:/etc/frr/daemons
        - router16/frr.conf:/etc/frr/frr.conf
    router17:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router17/daemons:/etc/frr/daemons
        - router17/frr.conf:/etc/frr/frr.conf
    router18:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router18/daemons:/etc/frr/daemons
        - router18/frr.conf:/etc/frr/frr.conf
    router19:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router19/daemons:/etc/frr/daemons
        - router19/frr.conf:/etc/frr/frr.conf
    router20:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router20/daemons:/etc/frr/daemons
        - router20/frr.conf:/etc/frr/frr.conf
    router21:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router21/daemons:/etc/frr/daemons
        - router21/frr.conf:/etc/frr/frr.conf
    router22:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router22/daemons:/etc/frr/daemons
        - router22/frr.conf:/etc/frr/frr.conf
    router23:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router23/daemons:/etc/frr/daemons
        - router23/frr.conf:/etc/frr/frr.conf
    router24:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router24/daemons:/etc/frr/daemons
        - router24/frr.conf:/etc/frr/frr.conf
    router25:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router25/daemons:/etc/frr/daemons
        - router25/frr.conf:/etc/frr/frr.conf
    router26:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router26/daemons:/etc/frr/daemons
        - router26/frr.conf:/etc/frr/frr.conf
    router27:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - router27/daemons:/etc/frr/daemons
        - router27/frr.conf:/etc/frr/frr.conf

    #---------------------------------K3s Serf Nodes (162 nodes)---------------------------------
    serf1:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf1 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf1..."
          k3s server \
            --node-name serf1 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf1 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf2:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf2 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf2..."
          k3s server \
            --node-name serf2 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf2 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf3:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf3 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf3..."
          k3s server \
            --node-name serf3 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf3 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf4:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf4 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf4..."
          k3s server \
            --node-name serf4 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf4 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf5:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf5 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf5..."
          k3s server \
            --node-name serf5 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf5 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf6:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf6 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf6..."
          k3s server \
            --node-name serf6 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf6 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf7:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf7 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf7..."
          k3s server \
            --node-name serf7 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf7 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf8:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf8 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf8..."
          k3s server \
            --node-name serf8 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf8 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf9:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf9 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf9..."
          k3s server \
            --node-name serf9 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf9 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf10:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf10 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf10..."
          k3s server \
            --node-name serf10 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf10 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf11:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf11 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf11..."
          k3s server \
            --node-name serf11 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf11 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf12:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf12 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf12..."
          k3s server \
            --node-name serf12 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf12 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf13:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf13 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf13..."
          k3s server \
            --node-name serf13 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf13 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf14:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf14 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf14..."
          k3s server \
            --node-name serf14 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf14 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf15:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf15 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf15..."
          k3s server \
            --node-name serf15 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf15 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf16:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf16 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf16..."
          k3s server \
            --node-name serf16 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf16 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf17:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf17 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf17..."
          k3s server \
            --node-name serf17 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf17 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf18:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf18 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf18..."
          k3s server \
            --node-name serf18 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf18 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf19:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf19 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf19..."
          k3s server \
            --node-name serf19 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf19 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf20:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf20 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf20..."
          k3s server \
            --node-name serf20 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf20 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf21:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf21 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf21..."
          k3s server \
            --node-name serf21 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf21 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf22:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf22 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf22..."
          k3s server \
            --node-name serf22 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf22 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf23:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf23 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf23..."
          k3s server \
            --node-name serf23 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf23 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf24:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf24 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf24..."
          k3s server \
            --node-name serf24 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf24 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf25:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf25 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf25..."
          k3s server \
            --node-name serf25 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf25 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf26:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf26 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf26..."
          k3s server \
            --node-name serf26 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf26 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf27:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf27 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf27..."
          k3s server \
            --node-name serf27 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf27 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf28:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf28 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf28..."
          k3s server \
            --node-name serf28 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf28 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf29:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf29 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf29..."
          k3s server \
            --node-name serf29 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf29 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf30:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf30 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf30..."
          k3s server \
            --node-name serf30 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf30 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf31:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf31 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf31..."
          k3s server \
            --node-name serf31 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf31 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf32:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf32 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf32..."
          k3s server \
            --node-name serf32 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf32 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf33:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf33 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf33..."
          k3s server \
            --node-name serf33 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf33 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf34:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf34 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf34..."
          k3s server \
            --node-name serf34 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf34 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf35:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf35 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf35..."
          k3s server \
            --node-name serf35 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf35 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf36:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf36 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf36..."
          k3s server \
            --node-name serf36 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf36 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf37:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf37 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf37..."
          k3s server \
            --node-name serf37 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf37 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf38:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf38 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf38..."
          k3s server \
            --node-name serf38 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf38 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf39:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf39 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf39..."
          k3s server \
            --node-name serf39 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf39 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf40:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf40 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf40..."
          k3s server \
            --node-name serf40 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf40 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf41:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf41 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf41..."
          k3s server \
            --node-name serf41 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf41 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf42:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf42 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf42..."
          k3s server \
            --node-name serf42 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf42 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf43:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf43 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf43..."
          k3s server \
            --node-name serf43 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf43 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf44:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf44 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf44..."
          k3s server \
            --node-name serf44 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf44 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf45:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf45 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf45..."
          k3s server \
            --node-name serf45 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf45 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf46:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf46 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf46..."
          k3s server \
            --node-name serf46 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf46 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf47:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf47 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf47..."
          k3s server \
            --node-name serf47 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf47 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf48:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf48 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf48..."
          k3s server \
            --node-name serf48 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf48 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf49:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf49 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf49..."
          k3s server \
            --node-name serf49 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf49 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf50:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf50 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf50..."
          k3s server \
            --node-name serf50 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf50 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf51:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf51 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf51..."
          k3s server \
            --node-name serf51 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf51 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf52:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf52 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf52..."
          k3s server \
            --node-name serf52 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf52 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf53:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf53 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf53..."
          k3s server \
            --node-name serf53 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf53 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf54:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf54 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf54..."
          k3s server \
            --node-name serf54 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf54 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf55:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf55 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf55..."
          k3s server \
            --node-name serf55 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf55 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf56:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf56 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf56..."
          k3s server \
            --node-name serf56 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf56 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf57:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf57 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf57..."
          k3s server \
            --node-name serf57 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf57 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf58:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf58 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf58..."
          k3s server \
            --node-name serf58 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf58 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf59:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf59 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf59..."
          k3s server \
            --node-name serf59 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf59 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf60:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf60 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf60..."
          k3s server \
            --node-name serf60 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf60 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf61:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf61 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf61..."
          k3s server \
            --node-name serf61 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf61 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf62:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf62 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf62..."
          k3s server \
            --node-name serf62 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf62 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf63:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf63 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf63..."
          k3s server \
            --node-name serf63 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf63 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf64:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf64 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf64..."
          k3s server \
            --node-name serf64 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf64 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf65:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf65 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf65..."
          k3s server \
            --node-name serf65 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf65 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf66:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf66 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf66..."
          k3s server \
            --node-name serf66 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf66 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf67:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf67 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf67..."
          k3s server \
            --node-name serf67 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf67 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf68:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf68 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf68..."
          k3s server \
            --node-name serf68 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf68 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf69:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf69 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf69..."
          k3s server \
            --node-name serf69 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf69 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf70:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf70 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf70..."
          k3s server \
            --node-name serf70 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf70 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf71:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf71 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf71..."
          k3s server \
            --node-name serf71 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf71 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf72:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf72 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf72..."
          k3s server \
            --node-name serf72 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf72 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf73:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf73 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf73..."
          k3s server \
            --node-name serf73 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf73 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf74:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf74 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf74..."
          k3s server \
            --node-name serf74 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf74 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf75:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf75 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf75..."
          k3s server \
            --node-name serf75 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf75 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf76:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf76 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf76..."
          k3s server \
            --node-name serf76 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf76 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf77:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf77 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf77..."
          k3s server \
            --node-name serf77 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf77 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf78:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf78 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf78..."
          k3s server \
            --node-name serf78 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf78 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf79:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf79 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf79..."
          k3s server \
            --node-name serf79 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf79 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf80:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf80 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf80..."
          k3s server \
            --node-name serf80 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf80 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf81:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf81 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf81..."
          k3s server \
            --node-name serf81 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf81 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf82:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf82 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf82..."
          k3s server \
            --node-name serf82 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf82 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf83:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf83 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf83..."
          k3s server \
            --node-name serf83 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf83 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf84:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf84 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf84..."
          k3s server \
            --node-name serf84 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf84 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf85:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf85 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf85..."
          k3s server \
            --node-name serf85 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf85 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf86:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf86 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf86..."
          k3s server \
            --node-name serf86 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf86 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf87:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf87 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf87..."
          k3s server \
            --node-name serf87 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf87 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf88:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf88 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf88..."
          k3s server \
            --node-name serf88 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf88 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf89:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf89 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf89..."
          k3s server \
            --node-name serf89 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf89 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf90:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf90 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf90..."
          k3s server \
            --node-name serf90 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf90 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf91:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf91 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf91..."
          k3s server \
            --node-name serf91 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf91 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf92:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf92 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf92..."
          k3s server \
            --node-name serf92 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf92 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf93:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf93 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf93..."
          k3s server \
            --node-name serf93 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf93 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf94:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf94 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf94..."
          k3s server \
            --node-name serf94 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf94 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf95:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf95 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf95..."
          k3s server \
            --node-name serf95 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf95 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf96:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf96 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf96..."
          k3s server \
            --node-name serf96 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf96 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf97:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf97 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf97..."
          k3s server \
            --node-name serf97 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf97 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf98:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf98 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf98..."
          k3s server \
            --node-name serf98 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf98 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf99:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf99 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf99..."
          k3s server \
            --node-name serf99 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf99 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf100:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf100 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf100..."
          k3s server \
            --node-name serf100 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf100 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf101:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf101 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf101..."
          k3s server \
            --node-name serf101 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf101 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf102:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf102 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf102..."
          k3s server \
            --node-name serf102 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf102 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf103:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf103 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf103..."
          k3s server \
            --node-name serf103 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf103 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf104:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf104 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf104..."
          k3s server \
            --node-name serf104 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf104 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf105:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf105 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf105..."
          k3s server \
            --node-name serf105 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf105 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf106:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf106 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf106..."
          k3s server \
            --node-name serf106 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf106 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf107:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf107 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf107..."
          k3s server \
            --node-name serf107 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf107 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf108:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf108 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf108..."
          k3s server \
            --node-name serf108 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf108 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf109:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf109 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf109..."
          k3s server \
            --node-name serf109 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf109 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf110:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf110 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf110..."
          k3s server \
            --node-name serf110 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf110 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf111:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf111 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf111..."
          k3s server \
            --node-name serf111 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf111 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf112:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf112 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf112..."
          k3s server \
            --node-name serf112 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf112 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf113:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf113 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf113..."
          k3s server \
            --node-name serf113 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf113 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf114:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf114 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf114..."
          k3s server \
            --node-name serf114 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf114 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf115:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf115 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf115..."
          k3s server \
            --node-name serf115 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf115 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf116:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf116 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf116..."
          k3s server \
            --node-name serf116 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf116 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf117:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf117 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf117..."
          k3s server \
            --node-name serf117 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf117 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf118:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf118 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf118..."
          k3s server \
            --node-name serf118 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf118 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf119:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf119 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf119..."
          k3s server \
            --node-name serf119 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf119 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf120:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf120 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf120..."
          k3s server \
            --node-name serf120 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf120 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf121:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf121 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf121..."
          k3s server \
            --node-name serf121 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf121 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf122:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf122 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf122..."
          k3s server \
            --node-name serf122 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf122 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf123:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf123 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf123..."
          k3s server \
            --node-name serf123 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf123 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf124:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf124 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf124..."
          k3s server \
            --node-name serf124 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf124 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf125:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf125 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf125..."
          k3s server \
            --node-name serf125 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf125 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf126:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf126 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf126..."
          k3s server \
            --node-name serf126 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf126 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf127:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf127 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf127..."
          k3s server \
            --node-name serf127 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf127 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf128:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf128 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf128..."
          k3s server \
            --node-name serf128 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf128 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf129:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf129 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf129..."
          k3s server \
            --node-name serf129 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf129 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf130:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf130 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf130..."
          k3s server \
            --node-name serf130 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf130 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf131:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf131 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf131..."
          k3s server \
            --node-name serf131 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf131 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf132:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf132 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf132..."
          k3s server \
            --node-name serf132 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf132 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf133:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf133 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf133..."
          k3s server \
            --node-name serf133 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf133 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf134:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf134 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf134..."
          k3s server \
            --node-name serf134 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf134 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf135:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf135 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf135..."
          k3s server \
            --node-name serf135 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf135 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf136:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf136 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf136..."
          k3s server \
            --node-name serf136 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf136 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf137:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf137 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf137..."
          k3s server \
            --node-name serf137 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf137 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf138:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf138 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf138..."
          k3s server \
            --node-name serf138 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf138 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf139:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf139 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf139..."
          k3s server \
            --node-name serf139 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf139 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf140:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf140 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf140..."
          k3s server \
            --node-name serf140 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf140 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf141:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf141 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf141..."
          k3s server \
            --node-name serf141 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf141 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf142:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf142 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf142..."
          k3s server \
            --node-name serf142 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf142 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf143:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf143 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf143..."
          k3s server \
            --node-name serf143 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf143 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf144:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf144 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf144..."
          k3s server \
            --node-name serf144 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf144 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf145:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf145 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf145..."
          k3s server \
            --node-name serf145 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf145 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf146:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf146 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf146..."
          k3s server \
            --node-name serf146 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf146 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf147:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf147 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf147..."
          k3s server \
            --node-name serf147 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf147 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf148:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf148 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf148..."
          k3s server \
            --node-name serf148 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf148 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf149:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf149 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf149..."
          k3s server \
            --node-name serf149 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf149 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf150:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf150 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf150..."
          k3s server \
            --node-name serf150 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf150 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf151:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf151 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf151..."
          k3s server \
            --node-name serf151 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf151 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf152:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf152 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf152..."
          k3s server \
            --node-name serf152 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf152 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf153:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf153 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf153..."
          k3s server \
            --node-name serf153 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf153 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf154:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf154 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf154..."
          k3s server \
            --node-name serf154 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf154 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf155:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf155 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf155..."
          k3s server \
            --node-name serf155 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf155 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf156:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf156 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf156..."
          k3s server \
            --node-name serf156 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf156 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf157:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf157 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf157..."
          k3s server \
            --node-name serf157 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf157 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf158:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf158 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf158..."
          k3s server \
            --node-name serf158 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf158 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf159:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf159 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf159..."
          k3s server \
            --node-name serf159 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf159 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf160:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf160 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf160..."
          k3s server \
            --node-name serf160 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf160 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf161:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf161 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf161..."
          k3s server \
            --node-name serf161 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf161 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

    serf162:
      kind: linux
      image: abdullahmuzlim279/k3s-serf-node:warmcache-test
      env:
        CLAB_LINUX_PRIVILEGED: "true"
      binds:
        - scripts/init.sh:/init.sh
        - ip-mapping.txt:/ip-mapping.txt
        - /sys/fs/cgroup:/sys/fs/cgroup:rw
        - /lib/modules:/lib/modules:ro
        - /dev:/dev
      cmd: >
        bash -c '
          set -e
          echo "[INIT] Starting serf162 initialization..."
          ulimit -n 65536
          sysctl -w fs.inotify.max_user_instances=4096 2>/dev/null || true
          sysctl -w fs.inotify.max_user_watches=524288 2>/dev/null || true
          sysctl -w fs.file-max=2097152 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/cpu.pressure 2>/dev/null || true
          echo 0 > /sys/fs/cgroup/memory.pressure 2>/dev/null || true
          echo "[NET] Running init.sh for IP configuration..."
          bash /init.sh
          SERF_IP=$(ip addr show eth1 | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
          echo "[NET] Configured IP: $SERF_IP"
          ip link set eth1 mtu 1400
          sleep $((RANDOM % 10 + 5))
          echo "[K3S] Launching K3s server for serf162..."
          k3s server \
            --node-name serf162 \
            --disable traefik \
            --disable servicelb \
            --disable local-storage \
            --disable metrics-server \
            --disable-cloud-controller \
            --disable-network-policy \
            --disable-helm-controller \
            --snapshotter native \
            --tls-san $SERF_IP \
            --kubelet-arg=cgroup-root=/ \
            --kubelet-arg=cgroups-per-qos=false \
            --kubelet-arg=enforce-node-allocatable= \
            --v=0 &
          sleep 20
          chmod 666 /etc/rancher/k3s/k3s.yaml
          export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
          echo "[K3S] Waiting for containerd..."
          until /usr/local/bin/k3s ctr version >/dev/null 2>&1; do sleep 3; done
          echo "[K3S] Importing cached images..."
          for f in /opt/k3s-images/*.tar; do
            /usr/local/bin/k3s ctr images import "$f" 2>/dev/null || true
          done
          echo "[K3S] Deploying controllers..."
          k3s kubectl apply -f /tmp/qos-controller-daemonset.yaml
          k3s kubectl apply -f /tmp/service-account.yaml
          k3s kubectl apply -f /tmp/cluster-role.yaml
          k3s kubectl apply -f /tmp/cluster-role-binding.yaml
          k3s kubectl apply -f /tmp/deployment-scheduler.yaml
          k3s kubectl apply -f /tmp/ram_price.yaml
          k3s kubectl apply -f /tmp/storage_price.yaml
          k3s kubectl apply -f /tmp/vcpu_price.yaml
          k3s kubectl apply -f /tmp/vgpu_price.yaml
          mkdir -p ~/.kube
          cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
          chown $(whoami):$(whoami) ~/.kube/config 2>/dev/null || true
          chmod 600 ~/.kube/config
          echo "[READY] serf162 K3s cluster is ready!"
          while true; do sync; echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true; sleep 100000; done &
          sleep infinity
        '

  #---------------------------------Links---------------------------------
  links:
    #---------------------------------Router2Router connections---------------------------------
    #Router1
    - endpoints: ["router1:eth1", "router2:eth1"] #
    - endpoints: ["router1:eth2", "router3:eth1"]
    #Router2
    - endpoints: ["router2:eth2", "router4:eth1"]
    #Router3
    - endpoints: ["router3:eth2", "router8:eth1"]
    #Router4
    - endpoints: ["router4:eth2", "router5:eth1"]
    - endpoints: ["router4:eth3", "router6:eth1"]
    #Router5
    - endpoints: ["router5:eth2", "router9:eth1"]
    #Router6
    - endpoints: ["router6:eth2", "router7:eth1"]
    #Router7
    - endpoints: ["router7:eth2", "router8:eth2"]
    #Router8
    - endpoints: ["router8:eth3", "router9:eth2"]
    - endpoints: ["router8:eth4", "router12:eth1"]
    - endpoints: ["router8:eth5", "router14:eth1"]
    #Router9
    - endpoints: ["router9:eth3", "router10:eth1"]
    - endpoints: ["router9:eth4", "router11:eth1"]
    #Router10
    - endpoints: ["router10:eth2", "router15:eth1"]
    #Router11
    - endpoints: ["router11:eth2", "router14:eth2"]
    #Router12
    - endpoints: ["router12:eth2", "router13:eth1"]
    #Router13
    - endpoints: ["router13:eth2", "router14:eth3"]
    - endpoints: ["router13:eth3", "router16:eth1"]
    #Router14
    - endpoints: ["router14:eth4", "router15:eth2"]
    #Router15
    - endpoints: ["router15:eth3", "router17:eth1"]
    #Router16 => no new connections
    #Router17
    - endpoints: ["router17:eth2", "router18:eth1"]
    - endpoints: ["router17:eth3", "router19:eth1"]
    - endpoints: ["router17:eth4", "router20:eth1"]
    - endpoints: ["router17:eth5", "router25:eth1"]
    #Router18
    - endpoints: ["router18:eth2", "router20:eth2"]
    #Router19
    - endpoints: ["router19:eth2", "router24:eth1"]
    #Router20
    - endpoints: ["router20:eth3", "router21:eth1"]
    - endpoints: ["router20:eth4", "router22:eth1"]
    - endpoints: ["router20:eth5", "router23:eth1"]
    - endpoints: ["router20:eth6", "router25:eth2"]
    #Router21 => no new connections
    #Router22 => no new connections
    #Router23
    - endpoints: ["router23:eth2", "router24:eth2"]
    #Router24
    - endpoints: ["router24:eth3", "router25:eth3"]
    #Router25
    # - endpoints: ["router25:eth4", "router26:eth1"]
    #Router26 => no new connections
    #Router27 => not connected to any router

    #---------------------------------Router2Switch connections---------------------------------
    #Router1
    - endpoints: ["router1:eth3", "switch5:ovs5p1"]
    - endpoints: ["router1:eth4", "switch4:ovs4p1"]
    #Router2 => no switch connected
    #Router3
    - endpoints: ["router3:eth3", "switch15:ovs15p1"]
    #Router4
    - endpoints: ["router4:eth4", "switch6:ovs6p1"]
    - endpoints: ["router4:eth5", "switch7:ovs7p1"]
    - endpoints: ["router4:eth6", "switch8:ovs8p1"]
    - endpoints: ["router4:eth7", "switch9:ovs9p1"]
    #Router5
    - endpoints: ["router5:eth3", "switch12:ovs12p1"]
    - endpoints: ["router5:eth4", "switch13:ovs13p1"]
    - endpoints: ["router5:eth5", "switch14:ovs14p1"]
    #Router6
    - endpoints: ["router6:eth3", "switch10:ovs10p1"]
    - endpoints: ["router6:eth4", "switch11:ovs11p1"]
    #Router7 => no switch connected
    #Router8
    - endpoints: ["router8:eth6", "switch16:ovs16p1"]
    - endpoints: ["router8:eth7", "switch17:ovs17p1"]
    #Router9 => no switch connected
    #Router10
    - endpoints: ["router10:eth3", "switch23:ovs23p1"]
    #Router11
    - endpoints: ["router11:eth3", "switch18:ovs18p1"]
    - endpoints: ["router11:eth4", "switch19:ovs19p1"]
    #Router12 => no switch connected
    #Router13
    - endpoints: ["router13:eth4", "switch20:ovs20p1"]
    - endpoints: ["router13:eth5", "switch21:ovs21p1"]
    - endpoints: ["router13:eth6", "switch22:ovs22p1"]
    #Router14 => no switch connected
    #Router15 => no switch connected
    #Router16
    - endpoints: ["router16:eth2", "switch24:ovs24p1"]
    - endpoints: ["router16:eth3", "switch26:ovs26p1"]
    #Router17 => no switch connected
    #Router18 => no switch connected
    #Router19 => no switch connected
    #Router20
    - endpoints: ["router20:eth7", "switch28:ovs28p1"]
    - endpoints: ["router20:eth8", "switch32:ovs32p1"]
    - endpoints: ["router20:eth9", "switch33:ovs33p1"]
    #Router21
    - endpoints: ["router21:eth2", "switch29:ovs29p1"]
    - endpoints: ["router21:eth3", "switch30:ovs30p1"]
    #Router22
    - endpoints: ["router22:eth2", "switch27:ovs27p1"]
    #Router23 => no switch connected
    #Router24 => no switch connected
    #Router25
    - endpoints: ["router25:eth4", "switch34:ovs34p1"]
    - endpoints: ["router25:eth5", "switch35:ovs35p1"]
    - endpoints: ["router25:eth6", "switch36:ovs36p1"]
    #Router26
    - endpoints: ["router26:eth1", "switch33:ovs33p2"]
    - endpoints: ["router26:eth2", "switch34:ovs34p2"]
    #Router27
    - endpoints: ["router27:eth1", "switch34:ovs34p3"]
    - endpoints: ["router27:eth2", "switch35:ovs35p2"]
    - endpoints: ["router27:eth3", "switch36:ovs36p2"]
    - endpoints: ["router27:eth4", "switch37:ovs37p1"]

    #---------------------------------Switch2Switch connections---------------------------------
    #Switch1
    - endpoints: ["switch1:ovs1p1", "switch2:ovs2p1"]
    #Switch2
    - endpoints: ["switch2:ovs2p2", "switch3:ovs3p1"]
    #Switch3
    - endpoints: ["switch3:ovs3p2", "switch4:ovs4p2"]
    #Switch24
    - endpoints: ["switch24:ovs24p2", "switch25:ovs25p1"]
    #Switch25
    - endpoints: ["switch25:ovs25p2", "switch26:ovs26p2"]
    #Switch30
    - endpoints: ["switch30:ovs30p2", "switch31:ovs31p1"]

    #---------------------------------SerfNode2Switch connections---------------------------------
    #Switch1
    - endpoints: ["switch1:ovs1p2", "serf1:eth1"]
    - endpoints: ["switch1:ovs1p3", "serf2:eth1"]
    - endpoints: ["switch1:ovs1p4", "serf3:eth1"]
    - endpoints: ["switch1:ovs1p5", "serf4:eth1"]
    - endpoints: ["switch1:ovs1p6", "serf5:eth1"]
    #Switch2
    - endpoints: ["switch2:ovs2p3", "serf6:eth1"]
    - endpoints: ["switch2:ovs2p4", "serf7:eth1"]
    - endpoints: ["switch2:ovs2p5", "serf8:eth1"]
    #Switch3
    - endpoints: ["switch3:ovs3p3", "serf9:eth1"]
    - endpoints: ["switch3:ovs3p4", "serf10:eth1"]
    - endpoints: ["switch3:ovs3p5", "serf11:eth1"]
    #Switch4
    - endpoints: ["switch4:ovs4p3", "serf12:eth1"]
    - endpoints: ["switch4:ovs4p4", "serf13:eth1"]
    - endpoints: ["switch4:ovs4p5", "serf14:eth1"]
    #Switch5
    - endpoints: ["switch5:ovs5p2", "serf15:eth1"]
    #Switch6
    - endpoints: ["switch6:ovs6p2", "serf22:eth1"]
    - endpoints: ["switch6:ovs6p3", "serf23:eth1"]
    - endpoints: ["switch6:ovs6p4", "serf24:eth1"]
    - endpoints: ["switch6:ovs6p5", "serf25:eth1"]
    #Switch7
    - endpoints: ["switch7:ovs7p2", "serf26:eth1"]
    #Switch8
    - endpoints: ["switch8:ovs8p2", "serf27:eth1"]
    - endpoints: ["switch8:ovs8p3", "serf28:eth1"]
    - endpoints: ["switch8:ovs8p4", "serf29:eth1"]
    #Switch9
    - endpoints: ["switch9:ovs9p2", "serf20:eth1"]
    - endpoints: ["switch9:ovs9p3", "serf21:eth1"]
    #Switch10
    - endpoints: ["switch10:ovs10p2", "serf33:eth1"]
    - endpoints: ["switch10:ovs10p3", "serf34:eth1"]
    #Switch11
    - endpoints: ["switch11:ovs11p2", "serf35:eth1"]
    - endpoints: ["switch11:ovs11p3", "serf36:eth1"]
    - endpoints: ["switch11:ovs11p4", "serf37:eth1"]
    - endpoints: ["switch11:ovs11p5", "serf38:eth1"]
    - endpoints: ["switch11:ovs11p6", "serf39:eth1"]
    - endpoints: ["switch11:ovs11p7", "serf40:eth1"]
    - endpoints: ["switch11:ovs11p8", "serf41:eth1"]
    - endpoints: ["switch11:ovs11p9", "serf42:eth1"]
    #Switch12
    - endpoints: ["switch12:ovs12p2", "serf43:eth1"]
    - endpoints: ["switch12:ovs12p3", "serf44:eth1"]
    - endpoints: ["switch12:ovs12p4", "serf45:eth1"]
    #Switch13
    - endpoints: ["switch13:ovs13p2", "serf46:eth1"]
    #Switch1
    - endpoints: ["switch14:ovs14p2", "serf47:eth1"]
    #Switch15
    - endpoints: ["switch15:ovs15p2", "serf51:eth1"]
    #Switch16
    - endpoints: ["switch16:ovs16p2", "serf62:eth1"]
    #Switch17
    - endpoints: ["switch17:ovs17p2", "serf63:eth1"]
    #Switch18
    - endpoints: ["switch18:ovs18p2", "serf64:eth1"]
    #Switch19
    - endpoints: ["switch19:ovs19p2", "serf65:eth1"]
    #Switch20
    - endpoints: ["switch20:ovs20p2", "serf66:eth1"]
    - endpoints: ["switch20:ovs20p3", "serf67:eth1"]
    - endpoints: ["switch20:ovs20p4", "serf68:eth1"]
    #Switch21
    - endpoints: ["switch21:ovs21p2", "serf69:eth1"]
    - endpoints: ["switch21:ovs21p3", "serf70:eth1"]
    - endpoints: ["switch21:ovs21p4", "serf71:eth1"]
    - endpoints: ["switch21:ovs21p5", "serf72:eth1"]
    - endpoints: ["switch21:ovs21p6", "serf73:eth1"]
    - endpoints: ["switch21:ovs21p7", "serf74:eth1"]
    - endpoints: ["switch21:ovs21p8", "serf75:eth1"]
    - endpoints: ["switch21:ovs21p9", "serf76:eth1"]
    - endpoints: ["switch21:ovs21p10", "serf77:eth1"]
    - endpoints: ["switch21:ovs21p11", "serf78:eth1"]
    - endpoints: ["switch21:ovs21p12", "serf79:eth1"]
    #Switch22
    - endpoints: ["switch22:ovs22p2", "serf80:eth1"]
    #Switch23
    - endpoints: ["switch23:ovs23p2", "serf82:eth1"]
    #Switch24
    - endpoints: ["switch24:ovs24p3", "serf83:eth1"]
    - endpoints: ["switch24:ovs24p4", "serf84:eth1"]
    - endpoints: ["switch24:ovs24p5", "serf85:eth1"]
    #Switch25
    - endpoints: ["switch25:ovs25p3", "serf86:eth1"]
    #Switch26
    - endpoints: ["switch26:ovs26p3", "serf87:eth1"]
    - endpoints: ["switch26:ovs26p4", "serf88:eth1"]
    - endpoints: ["switch26:ovs26p5", "serf89:eth1"]
    #Switch27
    - endpoints: ["switch27:ovs27p2", "serf96:eth1"]
    - endpoints: ["switch27:ovs27p3", "serf97:eth1"]
    - endpoints: ["switch27:ovs27p4", "serf98:eth1"]
    #Switch28
    - endpoints: ["switch28:ovs28p2", "serf112:eth1"]
    - endpoints: ["switch28:ovs28p3", "serf113:eth1"]
    - endpoints: ["switch28:ovs28p4", "serf114:eth1"]
    #Switch29
    - endpoints: ["switch29:ovs29p2", "serf115:eth1"]
    - endpoints: ["switch29:ovs29p3", "serf116:eth1"]
    #Switch30
    - endpoints: ["switch30:ovs30p3", "serf117:eth1"]
    #Switch31
    - endpoints: ["switch31:ovs31p2", "serf118:eth1"]
    - endpoints: ["switch31:ovs31p3", "serf119:eth1"]
    - endpoints: ["switch31:ovs31p4", "serf120:eth1"]
    #Switch32
    - endpoints: ["switch32:ovs32p2", "serf128:eth1"]
    #Switch33
    - endpoints: ["switch33:ovs33p3", "serf129:eth1"]
    #Switch34
    - endpoints: ["switch34:ovs34p4", "serf130:eth1"]
    - endpoints: ["switch34:ovs34p5", "serf131:eth1"]
    - endpoints: ["switch34:ovs34p6", "serf132:eth1"]
    - endpoints: ["switch34:ovs34p7", "serf133:eth1"]
    - endpoints: ["switch34:ovs34p8", "serf134:eth1"]
    - endpoints: ["switch34:ovs34p9", "serf135:eth1"]
    - endpoints: ["switch34:ovs34p10", "serf136:eth1"]
    - endpoints: ["switch34:ovs34p11", "serf137:eth1"]
    - endpoints: ["switch34:ovs34p12", "serf138:eth1"]
    - endpoints: ["switch34:ovs34p13", "serf139:eth1"]
    - endpoints: ["switch34:ovs34p14", "serf140:eth1"]
    - endpoints: ["switch34:ovs34p15", "serf141:eth1"]
    #Switch35
    - endpoints: ["switch35:ovs35p3", "serf142:eth1"]
    - endpoints: ["switch35:ovs35p4", "serf143:eth1"]
    - endpoints: ["switch35:ovs35p5", "serf144:eth1"]
    - endpoints: ["switch35:ovs35p6", "serf145:eth1"]
    - endpoints: ["switch35:ovs35p7", "serf146:eth1"]
    #Switch36
    - endpoints: ["switch36:ovs36p3", "serf147:eth1"]
    - endpoints: ["switch36:ovs36p4", "serf148:eth1"]
    - endpoints: ["switch36:ovs36p5", "serf149:eth1"]
    - endpoints: ["switch36:ovs36p6", "serf150:eth1"]
    - endpoints: ["switch36:ovs36p7", "serf151:eth1"]
    - endpoints: ["switch36:ovs36p8", "serf152:eth1"]
    - endpoints: ["switch36:ovs36p9", "serf153:eth1"]
    - endpoints: ["switch36:ovs36p10", "serf154:eth1"]
    - endpoints: ["switch36:ovs36p11", "serf155:eth1"]
    - endpoints: ["switch36:ovs36p12", "serf156:eth1"]
    #Switch37
    - endpoints: ["switch37:ovs37p2", "serf162:eth1"]

    #---------------------------------SerfNode2Router connections---------------------------------
    #Router1
    - endpoints: ["router1:eth5", "serf16:eth1"]
    - endpoints: ["router1:eth6", "serf17:eth1"]
    #Router2
    - endpoints: ["router2:eth3", "serf18:eth1"]
    - endpoints: ["router2:eth4", "serf19:eth1"]
    #Router3
    - endpoints: ["router3:eth4", "serf52:eth1"]
    - endpoints: ["router3:eth5", "serf53:eth1"]
    - endpoints: ["router3:eth6", "serf54:eth1"]
    - endpoints: ["router3:eth7", "serf55:eth1"]
    - endpoints: ["router3:eth8", "serf56:eth1"]
    #Router4
    - endpoints: ["router4:eth8", "serf30:eth1"]
    - endpoints: ["router4:eth9", "serf31:eth1"]
    - endpoints: ["router4:eth10", "serf32:eth1"]
    #Router5
    - endpoints: ["router5:eth6", "serf48:eth1"]
    - endpoints: ["router5:eth7", "serf49:eth1"]
    - endpoints: ["router5:eth8", "serf50:eth1"]
    #Router6 => no connected serf nodes
    #Router7 => no connected serf nodes
    #Router8
    - endpoints: ["router8:eth8", "serf57:eth1"]
    - endpoints: ["router8:eth9", "serf58:eth1"]
    - endpoints: ["router8:eth10", "serf59:eth1"]
    - endpoints: ["router8:eth11", "serf60:eth1"]
    - endpoints: ["router8:eth12", "serf61:eth1"]
    #Router9 => no connected serf nodes
    #Router10 => no connected serf nodes
    #Router11 => no connected serf nodes
    #Router12 => no connected serf nodes
    #Router13
    - endpoints: ["router13:eth7", "serf81:eth1"]
    #Router14 => no connected serf nodes
    #Router15 => no connected serf nodes
    #Router16
    - endpoints: ["router16:eth4", "serf90:eth1"]
    - endpoints: ["router16:eth5", "serf91:eth1"]
    - endpoints: ["router16:eth6", "serf92:eth1"]
    - endpoints: ["router16:eth7", "serf93:eth1"]
    - endpoints: ["router16:eth8", "serf94:eth1"]
    - endpoints: ["router16:eth9", "serf95:eth1"]
    #Router17
    - endpoints: ["router17:eth6", "serf104:eth1"]
    - endpoints: ["router17:eth7", "serf105:eth1"]
    #Router18 => no connected serf nodes
    #Router19 => no connected serf nodes
    #Router20
    - endpoints: ["router20:eth10", "serf106:eth1"]
    - endpoints: ["router20:eth11", "serf107:eth1"]
    - endpoints: ["router20:eth12", "serf108:eth1"]
    - endpoints: ["router20:eth13", "serf109:eth1"]
    - endpoints: ["router20:eth14", "serf110:eth1"]
    - endpoints: ["router20:eth15", "serf111:eth1"]
    #Router21 => no connected serf nodes
    #Router22
    - endpoints: ["router22:eth3", "serf99:eth1"]
    - endpoints: ["router22:eth4", "serf100:eth1"]
    - endpoints: ["router22:eth5", "serf101:eth1"]
    - endpoints: ["router22:eth6", "serf102:eth1"]
    - endpoints: ["router22:eth7", "serf103:eth1"]
    #Router23
    - endpoints: ["router23:eth3", "serf121:eth1"]
    - endpoints: ["router23:eth4", "serf122:eth1"]
    - endpoints: ["router23:eth5", "serf123:eth1"]
    - endpoints: ["router23:eth6", "serf124:eth1"]
    #Router24
    - endpoints: ["router24:eth4", "serf125:eth1"]
    - endpoints: ["router24:eth5", "serf126:eth1"]
    #Router25
    - endpoints: ["router25:eth7", "serf127:eth1"]
    #Router26 => no connected serf nodes
    #Router27
    - endpoints: ["router27:eth5", "serf157:eth1"]
    - endpoints: ["router27:eth6", "serf158:eth1"]
    - endpoints: ["router27:eth7", "serf159:eth1"]
    - endpoints: ["router27:eth8", "serf160:eth1"]
    - endpoints: ["router27:eth9", "serf161:eth1"]
